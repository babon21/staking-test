# Staking test project
## Функционал
- юзер имеет возможность стейкать неограниченное количество раз с разными настройками периода стейкинга;
- период стейкинга устанавливается пользователем один раз и не может изменяться в процессе;
- возможность установки базового APY за стекинг и бонуса в APY за количество дней стейкинга  с шагом 7, 14, 30, 60, 180, 300 дней. Формула следующая: награда за стекинг = период * APY / 365 + период * бонус APY / 365. Если количество дней 7 - бонус за 7 дней, если 30 - бонус за 30.
- пул наград за стекинг формируется из токенов, посланных через трансфер на адрес контракта или на другой адрес. При каждом вызове функции стейкинга в этом пуле резервируется определенное количество токенов, которые гарантируют выплату награды в конце периода. Если токенов недостаточно - исключение в контракте;
- предусмотрен функционал токенов со смарт-контракта. Вызывается овнером;
- функция смены овнера реализована в контракте через наследование контракта Ownable (openzeppelin);

## Структура проекта
- контракты находятся в папке contracts
- тесты находятся в папке tests
- конфигурация проекта находится в файле brownie-config.yml

## Команды
Компиляция проекта осуществляется командой:
```
brownie compile
```

Прогон тестов осуществляется командой:
```
brownie test
```

## Документация контракта

Конструктор принимает адрес IERC20 токена, базовый APY, и массив бонусных APY за 7, 14, 30, 60, 180, 300 дней.
```
constructor(address _token, uint _baseApy, uint[] memory _bonusApy)
```
---
Метод добавления токенов в пул контракта, amount - кол-во токенов
```
function addToPool(uint256 amount)
```
---
Стейкинг ERC20 токена на amount токенов и periodDays дней.
```
function stake(uint256 amount, uint periodDays)
```
---
Снятие ставки, возможно только по окончанию периода ставки, иначе исключение
```
function unstake(uint256 stakingId)
```
---
Вывод токенов из пула овнеру, вызывается только овнером.
```
function withdrawTokens()
```
---
Событие `Stake` по окончанию функции `stake`.
- `account` - адрес пользователя
- `startDate` - дата начало ставки
- `endDate` - дата окончания ставки
- `stakingId` - id ставки
- `shares` - кол-во токенов, которое получит пользователь при снятии ставки
- `stakedAmount` - поставленное кол-во токенов
```
event Stake(
        address indexed account,
        uint256 startDate,
        uint256 endDate,
        uint256 indexed stakingId,
        uint256 indexed shares,
        uint256 stakedAmount
)
```
---
Событие `Unstake` по окончанию функции `unstake`.
- `account` - адрес пользователя
- `unstakeDate` - дата снятия ставки
- `stakingId` - id ставки
- `shares` - кол-во токенов, которое получит пользователь при снятии ставки
```
event Unstake(
        address indexed account,
        uint256 unstakeDate,
        uint256 indexed stakingId,
        uint256 indexed shares
)
```